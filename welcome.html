<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome - Smart Door Access System</title>
    <link rel="stylesheet" href="user-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .welcome-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
        }

        .welcome-header {
            background: rgba(255, 255, 255, 0.1);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            padding: var(--spacing-lg) var(--spacing-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--white);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo i {
            font-size: 2rem;
        }

        .user-welcome {
            color: var(--white);
            font-size: 1.1rem;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .welcome-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-2xl);
            text-align: center;
        }

        .welcome-hero {
            max-width: 800px;
            margin-bottom: var(--spacing-2xl);
        }

        .welcome-title {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: var(--spacing-lg);
            text-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .welcome-subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: var(--spacing-xl);
            line-height: 1.6;
        }

        .user-info-card {
            background: rgba(255, 255, 255, 0.15);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-2xl);
            box-shadow: var(--shadow-2xl);
        }

        .user-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: var(--radius-full);
            background: var(--white);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 0 auto var(--spacing-lg);
            box-shadow: var(--shadow-lg);
        }

        .user-details {
            color: var(--white);
        }

        .user-name {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .user-title {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: var(--spacing-md);
        }

        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: var(--spacing-xs);
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .navigation-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-xl);
            max-width: 1200px;
            width: 100%;
        }

        .nav-card {
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            text-align: center;
            transition: var(--transition-normal);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .nav-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            opacity: 0;
            transition: var(--transition-fast);
        }

        .nav-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-2xl);
        }

        .nav-card:hover::before {
            opacity: 1;
        }

        .nav-icon {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-full);
            background: var(--primary-gradient);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto var(--spacing-lg);
            box-shadow: var(--shadow-md);
            transition: var(--transition-fast);
        }

        .nav-card:hover .nav-icon {
            transform: scale(1.1);
            box-shadow: var(--shadow-glow);
        }

        .nav-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .nav-description {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
            line-height: 1.6;
        }

        .nav-features {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: left;
        }

        .nav-features li {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: var(--spacing-sm);
        }

        .nav-features i {
            color: var(--success-color);
            font-size: 0.8rem;
        }

        .quick-actions {
            position: fixed;
            bottom: var(--spacing-xl);
            right: var(--spacing-xl);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            z-index: 100;
        }

        .quick-action {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-full);
            background: var(--primary-gradient);
            color: var(--white);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-fast);
            text-decoration: none;
        }

        .quick-action:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-glow);
        }

        .notification-toast {
            position: fixed;
            top: var(--spacing-xl);
            right: var(--spacing-xl);
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            display: none;
            min-width: 300px;
            z-index: 1000;
        }

        .notification-toast.show {
            display: block;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .toast-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .toast-message {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2.5rem;
            }

            .welcome-subtitle {
                font-size: 1.1rem;
            }

            .welcome-header {
                padding: var(--spacing-md);
                flex-direction: column;
                gap: var(--spacing-md);
                text-align: center;
            }

            .user-welcome {
                order: -1;
            }

            .logout-btn {
                align-self: center;
            }

            .welcome-content {
                padding: var(--spacing-lg);
            }

            .navigation-cards {
                grid-template-columns: 1fr;
                padding: 0 var(--spacing-md);
                gap: var(--spacing-lg);
            }

            .nav-card {
                padding: var(--spacing-lg);
            }

            .nav-icon {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }

            .nav-title {
                font-size: 1.25rem;
            }

            .user-info-card {
                padding: var(--spacing-lg);
                margin-bottom: var(--spacing-lg);
            }

            .user-avatar-large {
                width: 80px;
                height: 80px;
                font-size: 2.5rem;
            }

            .user-name {
                font-size: 1.5rem;
            }

            .user-title {
                font-size: 1rem;
            }

            .user-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-md);
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .quick-actions {
                bottom: var(--spacing-md);
                right: var(--spacing-md);
            }

            .quick-action {
                width: 50px;
                height: 50px;
                font-size: 1.25rem;
            }

            .notification-toast {
                top: var(--spacing-md);
                right: var(--spacing-md);
                left: var(--spacing-md);
                min-width: auto;
            }
        }

        @media (max-width: 480px) {
            .welcome-title {
                font-size: 2rem;
            }

            .welcome-subtitle {
                font-size: 1rem;
            }

            .welcome-content {
                padding: var(--spacing-md);
            }

            .user-stats {
                grid-template-columns: 1fr;
            }

            .nav-card {
                padding: var(--spacing-md);
            }

            .nav-features {
                font-size: 0.85rem;
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            .nav-card {
                min-height: 44px;
                cursor: pointer;
            }

            .quick-action {
                min-width: 44px;
                min-height: 44px;
            }

            .logout-btn {
                min-height: 44px;
                padding: var(--spacing-sm) var(--spacing-md);
            }
        }

        /* Landscape mobile optimization */
        @media (max-width: 768px) and (orientation: landscape) {
            .welcome-content {
                padding: var(--spacing-sm) var(--spacing-lg);
            }

            .welcome-title {
                font-size: 2rem;
            }

            .user-info-card {
                padding: var(--spacing-md);
            }

            .navigation-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="welcome-container">
        <header class="welcome-header">
            <div class="logo">
                <i class="fas fa-door-open"></i>
                <span>Smart Door Access</span>
            </div>
            <div class="user-welcome">
                <span id="welcomeText">Welcome back!</span>
            </div>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </button>
        </header>

        <main class="welcome-content">
            <div class="welcome-hero">
                <h1 class="welcome-title">Welcome to Smart Access</h1>
                <p class="welcome-subtitle">
                    Your secure, intelligent door access system is ready. 
                    Choose from the options below to get started.
                </p>
            </div>

            <div class="user-info-card" id="userInfoCard">
                <div class="user-avatar-large">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">User</div>
                    <div class="user-title" id="userTitle">Department • Employee ID</div>
                    <div class="user-stats">
                        <div class="stat-item">
                            <div class="stat-number" id="accessCount">0</div>
                            <div class="stat-label">Access Attempts</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="successRate">100%</div>
                            <div class="stat-label">Success Rate</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="memberSince">Today</div>
                            <div class="stat-label">Member Since</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="navigation-cards">
                <div class="nav-card" onclick="navigateTo('user.html')">
                    <div class="nav-icon">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <h3 class="nav-title">Dashboard</h3>
                    <p class="nav-description">
                        View your access statistics, recent activity, and system notifications
                    </p>
                    <ul class="nav-features">
                        <li><i class="fas fa-check"></i> Real-time access status</li>
                        <li><i class="fas fa-check"></i> Activity history</li>
                        <li><i class="fas fa-check"></i> Notifications center</li>
                        <li><i class="fas fa-check"></i> Quick statistics</li>
                    </ul>
                </div>

                <div class="nav-card" onclick="navigateTo('user.html#access')">
                    <div class="nav-icon">
                        <i class="fas fa-door-open"></i>
                    </div>
                    <h3 class="nav-title">Door Access</h3>
                    <p class="nav-description">
                        Use face recognition technology to securely access doors
                    </p>
                    <ul class="nav-features">
                        <li><i class="fas fa-check"></i> Face recognition</li>
                        <li><i class="fas fa-check"></i> Camera integration</li>
                        <li><i class="fas fa-check"></i> Instant verification</li>
                        <li><i class="fas fa-check"></i> Secure access</li>
                    </ul>
                </div>

                <div class="nav-card" onclick="navigateTo('user.html#profile')">
                    <div class="nav-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <h3 class="nav-title">Profile Settings</h3>
                    <p class="nav-description">
                        Manage your account information and security preferences
                    </p>
                    <ul class="nav-features">
                        <li><i class="fas fa-check"></i> Personal information</li>
                        <li><i class="fas fa-check"></i> Security settings</li>
                        <li><i class="fas fa-check"></i> Password management</li>
                        <li><i class="fas fa-check"></i> Privacy controls</li>
                    </ul>
                </div>

                <div class="nav-card" onclick="navigateTo('user.html#history')">
                    <div class="nav-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <h3 class="nav-title">Access History</h3>
                    <p class="nav-description">
                        Review your complete access history and generate reports
                    </p>
                    <ul class="nav-features">
                        <li><i class="fas fa-check"></i> Detailed logs</li>
                        <li><i class="fas fa-check"></i> Export functionality</li>
                        <li><i class="fas fa-check"></i> Advanced filtering</li>
                        <li><i class="fas fa-check"></i> Search capabilities</li>
                    </ul>
                </div>
            </div>
        </main>

        <div class="quick-actions">
            <a href="user.html#access" class="quick-action" title="Quick Access">
                <i class="fas fa-key"></i>
            </a>
            <button class="quick-action" onclick="showHelp()" title="Help & Support">
                <i class="fas fa-question"></i>
            </button>
        </div>

        <div class="notification-toast" id="notificationToast">
            <div class="toast-header">
                <span class="toast-title" id="toastTitle">Notification</span>
                <button class="toast-close" onclick="hideToast()">&times;</button>
            </div>
            <div class="toast-message" id="toastMessage"></div>
        </div>
    </div>

    <script>
        class WelcomePage {
            constructor() {
                this.currentUser = null;
                this.init();
            }

            init() {
                this.loadUserSession();
                this.updateUserInterface();
                this.showWelcomeNotification();
                this.setupAutoLogout();
            }

            loadUserSession() {
                // Check for user session
                const sessionData = JSON.parse(
                    localStorage.getItem('userSession') || 
                    sessionStorage.getItem('userSession') || 
                    'null'
                );

                if (!sessionData || !sessionData.user) {
                    // No valid session, redirect to login
                    window.location.href = 'login.html';
                    return;
                }

                this.currentUser = sessionData.user;
                
                // Check session expiration (24 hours for remember me, 8 hours otherwise)
                const loginTime = new Date(sessionData.loginTime);
                const now = new Date();
                const expirationHours = sessionData.rememberMe ? 24 : 8;
                const expirationTime = new Date(loginTime.getTime() + (expirationHours * 60 * 60 * 1000));

                if (now > expirationTime) {
                    this.logout('Session expired. Please log in again.');
                    return;
                }
            }

            updateUserInterface() {
                if (!this.currentUser) return;

                // Update welcome text
                document.getElementById('welcomeText').textContent = 
                    `Welcome back, ${this.currentUser.firstName}!`;

                // Update user info card
                document.getElementById('userName').textContent = 
                    `${this.currentUser.firstName} ${this.currentUser.lastName}`;
                
                const userTitle = `${this.currentUser.department || 'General'} • ${this.currentUser.employeeId}`;
                document.getElementById('userTitle').textContent = userTitle;

                // Update stats
                this.updateUserStats();

                // Update avatar if user has custom avatar
                if (this.currentUser.avatar) {
                    const avatar = document.querySelector('.user-avatar-large');
                    avatar.innerHTML = `<img src="${this.currentUser.avatar}" alt="User Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                }
            }

            updateUserStats() {
                // Get user's access history
                const activities = JSON.parse(localStorage.getItem('loginActivities') || '[]');
                const userActivities = activities.filter(a => 
                    a.userId === this.currentUser.id || a.email === this.currentUser.email
                );

                const totalAccess = userActivities.length;
                const successfulAccess = userActivities.filter(a => a.success).length;
                const successRate = totalAccess > 0 ? Math.round((successfulAccess / totalAccess) * 100) : 100;

                document.getElementById('accessCount').textContent = totalAccess;
                document.getElementById('successRate').textContent = `${successRate}%`;

                // Calculate member since
                const registrationDate = this.currentUser.registrationDate || new Date().toISOString();
                const memberSince = this.formatMemberSince(new Date(registrationDate));
                document.getElementById('memberSince').textContent = memberSince;
            }

            formatMemberSince(date) {
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays < 1) {
                    return 'Today';
                } else if (diffDays < 7) {
                    return `${diffDays} day${diffDays > 1 ? 's' : ''}`;
                } else if (diffDays < 30) {
                    const weeks = Math.floor(diffDays / 7);
                    return `${weeks} week${weeks > 1 ? 's' : ''}`;
                } else if (diffDays < 365) {
                    const months = Math.floor(diffDays / 30);
                    return `${months} month${months > 1 ? 's' : ''}`;
                } else {
                    const years = Math.floor(diffDays / 365);
                    return `${years} year${years > 1 ? 's' : ''}`;
                }
            }

            showWelcomeNotification() {
                // Show welcome notification for new users or returning users
                const lastLogin = localStorage.getItem('lastWelcomeShown');
                const today = new Date().toDateString();

                if (lastLogin !== today) {
                    const isNewUser = !this.currentUser.registrationDate || 
                        new Date(this.currentUser.registrationDate).toDateString() === today;

                    const message = isNewUser 
                        ? "Welcome to Smart Door Access! Your account is ready to use."
                        : `Welcome back! Your last login was ${this.getLastLoginTime()}.`;

                    setTimeout(() => {
                        this.showToast('Welcome!', message);
                    }, 1000);

                    localStorage.setItem('lastWelcomeShown', today);
                }
            }

            getLastLoginTime() {
                const activities = JSON.parse(localStorage.getItem('loginActivities') || '[]');
                const userLogins = activities.filter(a => 
                    a.type === 'login' && 
                    a.success && 
                    (a.userId === this.currentUser.id || a.email === this.currentUser.email)
                );

                if (userLogins.length > 1) {
                    const lastLogin = new Date(userLogins[1].timestamp);
                    return lastLogin.toLocaleDateString();
                }
                return 'your first time';
            }

            showToast(title, message) {
                document.getElementById('toastTitle').textContent = title;
                document.getElementById('toastMessage').textContent = message;
                document.getElementById('notificationToast').classList.add('show');

                // Auto-hide after 5 seconds
                setTimeout(() => {
                    this.hideToast();
                }, 5000);
            }

            hideToast() {
                document.getElementById('notificationToast').classList.remove('show');
            }

            setupAutoLogout() {
                // Auto-logout after 30 minutes of inactivity
                let inactivityTimer;
                const INACTIVITY_TIME = 30 * 60 * 1000; // 30 minutes

                const resetTimer = () => {
                    clearTimeout(inactivityTimer);
                    inactivityTimer = setTimeout(() => {
                        this.logout('Logged out due to inactivity.');
                    }, INACTIVITY_TIME);
                };

                // Reset timer on user activity
                ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
                    document.addEventListener(event, resetTimer, true);
                });

                resetTimer(); // Start the timer
            }

            logout(message = null) {
                // Clear session data
                localStorage.removeItem('userSession');
                sessionStorage.removeItem('userSession');

                // Log logout activity
                const activities = JSON.parse(localStorage.getItem('loginActivities') || '[]');
                activities.unshift({
                    type: 'logout',
                    timestamp: new Date(),
                    userId: this.currentUser?.id,
                    success: true,
                    reason: message || 'User logout'
                });
                localStorage.setItem('loginActivities', JSON.stringify(activities.slice(0, 50)));

                // Redirect to login with message
                const redirectUrl = message 
                    ? `login.html?message=${encodeURIComponent(message)}`
                    : 'login.html';
                
                window.location.href = redirectUrl;
            }
        }

        // Navigation functions
        function navigateTo(url) {
            window.location.href = url;
        }

        function logout() {
            if (confirm('Are you sure you want to log out?')) {
                welcomePage.logout();
            }
        }

        function showHelp() {
            const helpMessage = `
Smart Door Access System Help

Quick Actions:
• Click any card to access that feature
• Use the quick access button (key icon) for immediate door access
• Your profile information is displayed in the center card

Security Features:
• Session timeout after 30 minutes of inactivity
• Secure face recognition technology
• Encrypted data transmission
• Activity logging and monitoring

Need more help?
• Visit the Help & Support section in the main application
• Contact support: group2@gmail.com
• Phone: 0761365727
            `;
            
            alert(helpMessage);
        }

        function hideToast() {
            document.getElementById('notificationToast').classList.remove('show');
        }

        // Initialize welcome page when DOM is loaded
        let welcomePage;
        document.addEventListener('DOMContentLoaded', () => {
            welcomePage = new WelcomePage();
        });

        // Handle browser back/forward buttons
        window.addEventListener('popstate', () => {
            // Prevent going back to login if user is still logged in
            const sessionData = JSON.parse(
                localStorage.getItem('userSession') || 
                sessionStorage.getItem('userSession') || 
                'null'
            );
            
            if (sessionData && sessionData.user) {
                window.history.pushState(null, '', window.location.href);
            }
        });

        // Prevent back button after login
        window.history.pushState(null, '', window.location.href);
    </script>
</body>
</html>