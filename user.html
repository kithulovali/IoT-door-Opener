<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - IoT Door Opener</title>
<link rel="stylesheet" href="user-styles.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<style>
  .navbar {
    background: rgba(13, 71, 161, 0.9);
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 100;
    /* Add vendor prefix for Safari support */
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .dashboard {
    padding: 2rem 0;
  }
  
  .door-status-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 1.5rem 0;
  }
  
  .door-status {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 1.5rem;
    font-weight: 600;
    padding: 1rem 2rem;
    border-radius: var(--radius-lg);
    /* Add vendor prefix for Safari support */
    -webkit-backdrop-filter: var(--glass-backdrop);
    backdrop-filter: var(--glass-backdrop);
    background: rgba(255, 255, 255, 0.1);
  }
  
  .door-status.open {
    color: var(--success-green);
    background: rgba(16, 185, 129, 0.15);
    border: 1px solid rgba(16, 185, 129, 0.3);
  }
  
  .door-status.closed {
    color: var(--danger-red);
    background: rgba(239, 68, 68, 0.15);
    border: 1px solid rgba(239, 68, 68, 0.3);
  }
  
  .door-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin: 1.5rem 0;
  }
  
  .camera-view {
    background: rgba(255, 255, 255, 0.05);
    border-radius: var(--radius-md);
    height: 250px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--gray-400);
    font-size: 1rem;
    margin: 1rem 0;
    border: 1px dashed var(--glass-border);
  }
  
  .camera-controls {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin: 1rem 0;
  }
  
  .visitor-alert {
    background: rgba(251, 191, 36, 0.15);
    border-left: 4px solid var(--warning-orange);
    padding: 1.5rem;
    border-radius: var(--radius-md);
    margin: 1.5rem 0;
    display: none;
  }
  
  .visitor-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    flex-wrap: wrap;
  }
  
  .logs-list {
    max-height: 250px;
    overflow-y: auto;
    background: rgba(255, 255, 255, 0.05);
    padding: 1rem;
    border-radius: var(--radius-md);
    margin: 1rem 0;
  }
  
  .log-item {
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 0.9rem;
  }
  
  .test-section {
    text-align: center;
  }
</style>
</head>
<body>

<header class="navbar">
  <div class="navbar-brand">
    <i class="bi bi-house-door"></i> IoT Door System
  </div>
  <nav class="navbar-menu">
    <a href="welcome.html" class="nav-link">
      <i class="bi bi-house"></i> Home
    </a>
    <a href="admin-login.html" class="nav-link">
      <i class="bi bi-shield-lock"></i> Admin
    </a>
    <a href="#" onclick="logout()" class="nav-link">
      <i class="bi bi-box-arrow-right"></i> Logout
    </a>
  </nav>
</header>

<div class="container">
  <div class="dashboard">
    <!-- Door Control -->
    <div class="card">
      <h1>
        <i class="bi bi-door-open"></i> Smart Door Control
      </h1>
      <div class="door-status-container">
        <div class="door-status closed" id="doorStatus">
          <i class="bi bi-lock status-icon"></i>
          <span class="status-text">Door is Locked</span>
        </div>
      </div>
      <div class="door-buttons">
        <button class="btn btn-success" onclick="openDoor()">
          <i class="bi bi-unlock"></i> Unlock Door
        </button>
        <button class="btn btn-danger" onclick="closeDoor()">
          <i class="bi bi-lock"></i> Lock Door
        </button>
      </div>
    </div>

    <!-- Camera Section -->
    <div class="card">
      <h2>
        <i class="bi bi-camera-video"></i> Security Camera
      </h2>
      <div class="camera-view" id="cameraView">
        <i class="bi bi-camera"></i> Click Start Camera
      </div>
      <div class="camera-controls">
        <button class="btn btn-primary" onclick="startCamera()">
          <i class="bi bi-play-circle"></i> Start
        </button>
        <button class="btn btn-warning" onclick="takePhoto()">
          <i class="bi bi-camera"></i> Capture
        </button>
        <button class="btn btn-secondary" onclick="stopCamera()">
          <i class="bi bi-stop-circle"></i> Stop
        </button>
      </div>
    </div>

    <!-- Visitor Alert -->
    <div class="visitor-alert" id="visitorAlert">
      <h3>
        <i class="bi bi-exclamation-triangle"></i> Unknown Visitor Detected!
      </h3>
      <p>Someone is trying to access the door. What would you like to do?</p>
      <div class="visitor-actions">
        <button class="btn btn-success" onclick="approveVisitor()">
          <i class="bi bi-check-circle"></i> Approve
        </button>
        <button class="btn btn-danger" onclick="denyVisitor()">
          <i class="bi bi-x-circle"></i> Deny
        </button>
      </div>
    </div>

    <!-- Activity Logs -->
    <div class="card">
      <h2>
        <i class="bi bi-clipboard-data"></i> Activity Logs
      </h2>
      <div class="logs-list" id="logsList">
        <div class="text-center text-gray-400">
          <i class="bi bi-clipboard"></i> No activity yet
        </div>
      </div>
      <div class="text-center">
        <button class="btn btn-outline" onclick="clearLogs()">
          <i class="bi bi-trash"></i> Clear Logs
        </button>
      </div>
    </div>

    <!-- Test / Simulation -->
    <div class="card test-section">
      <h2>
        <i class="bi bi-stars"></i> Testing & Simulation
      </h2>
      <p>Test the visitor detection system and door controls in a safe environment.</p>
      <button class="btn btn-warning" onclick="simulateVisitor()">
        <i class="bi bi-person"></i> Simulate Visitor
      </button>
    </div>
  </div>
  
  <footer class="footer">
    <p>&copy; <span id="currentYear"></span> IoT Door Pro. All rights reserved.</p>
  </footer>
</div>

<script src="simple-core.js"></script>
<script>
// Set current year
document.getElementById('currentYear').textContent = new Date().getFullYear();

let doorOpen = false;
let cameraActive = false;
let logs = [];

function openDoor() {
    doorOpen = true;
    updateDoorDisplay();
    addLog('Door unlocked');
}

function closeDoor() {
    doorOpen = false;
    updateDoorDisplay();
    addLog('Door locked');
}

function updateDoorDisplay() {
    const doorEl = document.getElementById('doorStatus');
    if(doorOpen){
        doorEl.className = 'door-status open';
        doorEl.innerHTML = '<i class="bi bi-unlock status-icon"></i> <span class="status-text">Door is Unlocked</span>';
    } else {
        doorEl.className = 'door-status closed';
        doorEl.innerHTML = '<i class="bi bi-lock status-icon"></i> <span class="status-text">Door is Locked</span>';
    }
}

function startCamera(){ 
    cameraActive=true; 
    addLog('Camera started'); 
    document.getElementById('cameraView').innerHTML='<i class="bi bi-camera-video"></i> Camera Active'; 
}

function stopCamera(){ 
    cameraActive=false; 
    addLog('Camera stopped'); 
    document.getElementById('cameraView').innerHTML='<i class="bi bi-camera"></i> Click Start Camera'; 
}

function takePhoto(){ 
    if(cameraActive){ 
        addLog('Photo captured'); 
        showMessage('Photo captured!', 'success'); 
    } else { 
        showMessage('Start camera first!', 'error'); 
    } 
}

function simulateVisitor(){ 
    document.getElementById('visitorAlert').style.display='block'; 
    addLog('Unknown visitor detected'); 
}

function approveVisitor(){ 
    document.getElementById('visitorAlert').style.display='none'; 
    openDoor(); 
    addLog('Visitor approved'); 
    setTimeout(closeDoor,5000); 
}

function denyVisitor(){ 
    document.getElementById('visitorAlert').style.display='none'; 
    addLog('Visitor denied'); 
}

function addLog(msg){
    const time = new Date().toLocaleTimeString();
    logs.unshift(`${time} - ${msg}`);
    const logList = document.getElementById('logsList');
    logList.innerHTML = logs.map(l => `<div class="log-item">${l}</div>`).join('');
}

function clearLogs(){ 
    logs=[]; 
    document.getElementById('logsList').innerHTML='<div class="text-center text-gray-400"><i class="bi bi-clipboard"></i> No activity yet</div>'; 
    addLog('Logs cleared');
}

function logout(){ 
    localStorage.clear(); 
    window.location.href='login.html'; 
}

function showMessage(message, type) {
    // Remove any existing messages
    const existingMessage = document.querySelector('.message');
    if (existingMessage) {
        existingMessage.remove();
    }
    
    // Create new message
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}`;
    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);
    
    // Remove message after 3 seconds
    setTimeout(() => {
        messageDiv.remove();
    }, 3000);
}

// Initialize door status
updateDoorDisplay();
</script>

</body>
</html>